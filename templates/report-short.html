<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.ReportMetadata.Title}}</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'montserrat': ['Montserrat', 'sans-serif'],
                        'condensed': ['Roboto Condensed', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* CSS Custom Properties */
        :root {
            /* Color Tokens */
            --color-border-light: #e7eaed;
            --color-border-accent: #C4CFE8;
            --color-text-primary: #364750;
            --color-text-secondary: #505964;
            --color-text-muted: #6B7280;

            /* Gradients */
            --gradient-card: linear-gradient(148.39deg, rgba(255,255,255,0.3) -34.39%, rgba(217,228,255,0.3) 102.8%);
            --gradient-card-subtle: linear-gradient(148.39deg, rgba(255,255,255,0.3) -34.39%, rgba(231,236,238,0.3) 102.8%);
        }

        /* Utility Classes */
        .bg-gradient-card {
            background: var(--gradient-card);
        }
        .bg-gradient-card-subtle {
            background: var(--gradient-card-subtle);
        }

        /* Print Styles */
        @page {
            size: A4;
            margin: 0.3in;
        }
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            .no-print { display: none; }
            thead {
                display: table-header-group;
            }
            tr {
                page-break-inside: avoid;
            }
            .page-break-before {
                page-break-before: always;
                break-before: page;
            }
        }
        * {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        /* Risk Level Colors */
        .risk-high {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
        }
        .risk-medium {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }
        .risk-low {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
        }

        /* Coverage Colors */
        .coverage-high {
            background: linear-gradient(to right, #ef4444, #dc2626);
        }
        .coverage-medium {
            background: linear-gradient(to right, #f59e0b, #d97706);
        }
        .coverage-low {
            background: linear-gradient(to right, #10b981, #059669);
        }
    </style>
</head>
<body class="font-montserrat bg-white text-gray-700 text-sm leading-snug">
    <div class="max-w-[210mm] mx-auto bg-white p-2.5">

        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <!-- Left: Qualys Logo and Title -->
            <div class="flex items-center gap-5">
                <div class="h-14">
                    <img src="./assets/qualys-logo.svg" alt="Qualys Logo" class="h-14 w-auto">
                </div>
                <div class="flex flex-col">
                    <h1 class="text-2xl font-bold text-gray-800 m-0 leading-tight">Application Exposure Report</h1>
                    <p class="text-sm text-gray-600 mt-1">powered by <span class="font-semibold">TotalAppSec</span></p>
                </div>
            </div>

            <!-- Right: Confidential Badge -->
            <div class="w-20 h-20 flex items-center justify-center" style="transform: rotate(15deg);">
                <img src="./assets/confidential-stamp.svg" alt="Confidential" class="w-full h-full opacity-30">
            </div>
        </header>

        <!-- Hero Section -->
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-6 mb-6">
            <!-- Line 1: Company Name -->
            <h1 class="text-2xl font-semibold text-gray-800 mb-2">
                {{if and .ReportMetadata.Industry .ReportMetadata.Industry.CompanyName}}
                    {{.ReportMetadata.Industry.CompanyName}}
                {{else if .ReportMetadata.TargetDomain}}
                    {{.ReportMetadata.TargetDomain}}
                {{else}}
                    ACME Corporation
                {{end}}
            </h1>

            <!-- Line 2: Industry -->
            <div class="flex items-center gap-2 text-sm text-gray-600 mb-2 overflow-hidden">
                <i class="fas fa-industry text-gray-500 flex-shrink-0"></i>
                <span class="font-semibold whitespace-nowrap flex-shrink-0">Industry:</span>
                <span class="truncate">{{if and .ReportMetadata.Industry .ReportMetadata.Industry.SubIndustry}}{{.ReportMetadata.Industry.SubIndustry}}{{else if .ReportMetadata.Industry}}{{.ReportMetadata.Industry.Industry}}{{else}}Retail{{end}}</span>
            </div>

            <!-- Line 2.5: Related Organizations -->
            {{if or (and .ReportMetadata.Industry .ReportMetadata.Industry.ParentCompany) (and .ReportMetadata.Industry .ReportMetadata.Industry.Subsidiaries)}}
            <div class="flex items-center gap-2 text-sm text-gray-600 mb-2 overflow-hidden">
                <i class="fas fa-sitemap text-gray-500 flex-shrink-0"></i>
                <span class="font-semibold whitespace-nowrap flex-shrink-0">Related Orgs:</span>
                <span class="truncate">
                    {{$count := 0}}
                    {{if .ReportMetadata.Industry.ParentCompany}}{{$count = add $count 1}}{{end}}
                    {{if .ReportMetadata.Industry.Subsidiaries}}{{$count = add $count (len .ReportMetadata.Industry.Subsidiaries)}}{{end}}
                    {{if .ReportMetadata.Industry.ParentCompany}}{{.ReportMetadata.Industry.ParentCompany}}{{if .ReportMetadata.Industry.Subsidiaries}}, {{end}}{{end}}{{if .ReportMetadata.Industry.Subsidiaries}}{{range $index, $sub := .ReportMetadata.Industry.Subsidiaries}}{{if lt $index 2}}{{if gt $index 0}}, {{end}}{{$sub}}{{end}}{{end}}{{if gt (len .ReportMetadata.Industry.Subsidiaries) 2}}...{{end}}{{end}} ({{$count}})
                </span>
            </div>
            {{end}}

            <!-- Line 2.6: Operating Regions -->
            {{if and .ReportMetadata.Industry .ReportMetadata.Industry.OperatingRegions}}
            <div class="flex items-center gap-2 text-sm text-gray-600 mb-2 overflow-hidden">
                <i class="fas fa-map-marked-alt text-gray-500 flex-shrink-0"></i>
                <span class="font-semibold whitespace-nowrap flex-shrink-0">Operating Regions:</span>
                <span class="truncate">{{if .ReportMetadata.Industry.HeadquartersCity}}HQ: {{.ReportMetadata.Industry.HeadquartersCity}} | {{end}}{{range $index, $region := .ReportMetadata.Industry.OperatingRegions}}{{if gt $index 0}}, {{end}}{{$region}}{{end}}</span>
            </div>
            {{end}}

            <!-- Line 3: Domains and Generated Date -->
            <div class="flex items-center gap-6 text-sm text-gray-600 mb-3">
                <div class="flex items-center gap-2">
                    <i class="fas fa-globe text-gray-500"></i>
                    <span>{{if .Summary.DomainMetrics}}{{.Summary.DomainMetrics.TotalDiscovered}}{{else}}544{{end}}</span>
                    <span>Domains</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="font-semibold">Generated on:</span>
                    <span>{{.ReportMetadata.Date}}</span>
                </div>
            </div>

            <!-- Line 4: Applicable Compliances -->
            {{if and .ReportMetadata.Industry .ReportMetadata.Industry.Compliances}}
            <div class="mt-3 pt-3 border-t border-[#e7eaed]">
                <p class="text-[11px] font-medium text-gray-700 mb-2">Applicable Compliance Frameworks <a href="#appendix-compliances" class="text-gray-600 hover:text-gray-800 transition-colors no-underline"><i class="far fa-circle-question text-xs"></i></a></p>
                <div class="flex gap-2 flex-wrap items-start">
                    {{range $index, $compliance := .ReportMetadata.Industry.Compliances}}
                    {{if lt $index 5}}
                    <a href="#compliance-{{$compliance.Name}}" class="px-3 py-1 rounded-2xl border border-[#C4CFE8] bg-gradient-card-subtle no-underline inline-block" >
                        <p class="text-xs font-medium text-gray-800">{{$compliance.Name}}</p>
                    </a>
                    {{end}}
                    {{end}}
                    {{if gt (len .ReportMetadata.Industry.Compliances) 5}}
                    <a href="#appendix-compliances" class="px-3 py-1 rounded-2xl border border-[#C4CFE8] bg-gradient-card-subtle no-underline inline-block" >
                        <p class="text-xs font-medium text-gray-600">Other +{{subtract (len .ReportMetadata.Industry.Compliances) 5}}</p>
                    </a>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>

        <!-- Application and Technology Exposure -->
        {{if or (gt .Summary.APIServers 0) (gt .Summary.APISpecificationsFound 0) (gt .Summary.AIAssetsFound 0) (gt .Summary.WebAppsFound 0) (and .Technologies (gt .Technologies.Count 0))}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6">
            <h2 class="text-xl font-medium text-gray-700 mb-5">Application and Technology Exposure</h2>

            <!-- Application Exposure Row -->
            {{if or (gt .Summary.APIServers 0) (gt .Summary.APISpecificationsFound 0) (gt .Summary.AIAssetsFound 0) (gt .Summary.WebAppsFound 0)}}
            <div class="grid grid-cols-4 gap-4 mb-4">
                {{if gt .Summary.APIServers 0}}
                <a href="#api-servers" class="flex flex-col justify-center p-4 rounded-2xl border border-[#C4CFE8] no-underline cursor-pointer bg-gradient-card" >
                    <p class="text-xs font-medium text-gray-800 mb-2">API Servers</p>
                    <p class="text-3xl font-bold text-gray-800 leading-none">{{.Summary.APIServers}}</p>
                </a>
                {{end}}
                {{if gt .Summary.APISpecificationsFound 0}}
                <a href="#api-specifications" class="flex flex-col justify-center p-4 rounded-2xl border border-[#C4CFE8] no-underline cursor-pointer bg-gradient-card" >
                    <p class="text-xs font-medium text-gray-800 mb-2">API Specifications</p>
                    <p class="text-3xl font-bold text-gray-800 leading-none">{{.Summary.APISpecificationsFound}}</p>
                </a>
                {{end}}
                {{if gt .Summary.AIAssetsFound 0}}
                <a href="#ai-services" class="flex flex-col justify-center p-4 rounded-2xl border border-[#C4CFE8] no-underline cursor-pointer bg-gradient-card" >
                    <p class="text-xs font-medium text-gray-800 mb-2">AI Apps</p>
                    <p class="text-3xl font-bold text-gray-800 leading-none">{{.Summary.AIAssetsFound}}</p>
                </a>
                {{end}}
                {{if gt .Summary.WebAppsFound 0}}
                <a href="#web-apps" class="flex flex-col justify-center p-4 rounded-2xl border border-[#C4CFE8] no-underline cursor-pointer bg-gradient-card" >
                    <p class="text-xs font-medium text-gray-800 mb-2">Web Apps</p>
                    <p class="text-3xl font-bold text-gray-800 leading-none">{{.Summary.WebAppsFound}}</p>
                </a>
                {{end}}
            </div>
            {{end}}

            <!-- Technology Exposure Row -->
            {{if and .Technologies (gt .Technologies.Count 0)}}
            <div class="flex gap-3 overflow-x-visible">
                {{range $index, $tech := .Technologies.Technologies}}
                {{if lt $index 4}}
                <a href="#tech-{{$tech.Slug}}" class="flex items-center gap-2 px-3 py-2 rounded-2xl border border-[#C4CFE8] min-w-[110px] bg-gradient-card-subtle no-underline" >
                    {{if $tech.Icon}}
                    <div class="flex-shrink-0 w-5 h-5 flex items-center justify-center">
                        <img src="./assets/{{$tech.Icon}}" alt="{{$tech.DisplayName}}" class="w-5 h-5 object-contain">
                    </div>
                    {{end}}
                    <div class="flex-1 min-w-0">
                        <p class="text-[11px] font-medium text-gray-700 truncate">{{$tech.DisplayName}}</p>
                        <p class="text-sm font-bold text-gray-800 leading-none">{{$tech.Count}} <span class="text-[11px] font-normal text-gray-600">domains</span></p>
                    </div>
                </a>
                {{end}}
                {{end}}
                {{if gt .Technologies.Count 4}}
                <a href="#technologies-found" class="flex items-center justify-center px-3 py-2 rounded-2xl border border-[#C4CFE8] min-w-[110px] no-underline cursor-pointer bg-gradient-card-subtle" >
                    <div class="text-center">
                        <p class="text-sm font-bold text-gray-800 leading-none">+{{subtract .Technologies.Count 4}}</p>
                        <p class="text-[11px] font-normal text-gray-700">other</p>
                    </div>
                </a>
                {{end}}
            </div>
            {{end}}
        </div>
        {{end}}

        <!-- Asset Criticality Score -->
        {{if or .Summary.APICriticality .Summary.WebAppCriticality .Summary.AIAssetCriticality}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6">
            <h2 class="text-xl font-medium text-gray-700 mb-1">Asset Criticality Score (ACS)</h2>
            <p class="text-xs text-gray-600 mb-4">Business importance predicted from domain patterns, asset function, and environment</p>

            <div class="grid grid-cols-5 gap-4">
                {{$totalCritical := 0}}
                {{$totalHigh := 0}}
                {{$totalMedium := 0}}
                {{$totalLow := 0}}
                {{$totalMinimal := 0}}

                {{if .Summary.APICriticality}}
                    {{$totalCritical = add $totalCritical .Summary.APICriticality.Critical}}
                    {{$totalHigh = add $totalHigh .Summary.APICriticality.High}}
                    {{$totalMedium = add $totalMedium .Summary.APICriticality.Medium}}
                    {{$totalLow = add $totalLow .Summary.APICriticality.Low}}
                    {{$totalMinimal = add $totalMinimal .Summary.APICriticality.Minimal}}
                {{end}}

                {{if .Summary.WebAppCriticality}}
                    {{$totalCritical = add $totalCritical .Summary.WebAppCriticality.Critical}}
                    {{$totalHigh = add $totalHigh .Summary.WebAppCriticality.High}}
                    {{$totalMedium = add $totalMedium .Summary.WebAppCriticality.Medium}}
                    {{$totalLow = add $totalLow .Summary.WebAppCriticality.Low}}
                    {{$totalMinimal = add $totalMinimal .Summary.WebAppCriticality.Minimal}}
                {{end}}

                {{if .Summary.AIAssetCriticality}}
                    {{$totalCritical = add $totalCritical .Summary.AIAssetCriticality.Critical}}
                    {{$totalHigh = add $totalHigh .Summary.AIAssetCriticality.High}}
                    {{$totalMedium = add $totalMedium .Summary.AIAssetCriticality.Medium}}
                    {{$totalLow = add $totalLow .Summary.AIAssetCriticality.Low}}
                    {{$totalMinimal = add $totalMinimal .Summary.AIAssetCriticality.Minimal}}
                {{end}}

                {{if .Summary.APISpecCriticality}}
                    {{$totalCritical = add $totalCritical .Summary.APISpecCriticality.Critical}}
                    {{$totalHigh = add $totalHigh .Summary.APISpecCriticality.High}}
                    {{$totalMedium = add $totalMedium .Summary.APISpecCriticality.Medium}}
                    {{$totalLow = add $totalLow .Summary.APISpecCriticality.Low}}
                    {{$totalMinimal = add $totalMinimal .Summary.APISpecCriticality.Minimal}}
                {{end}}

                <!-- Critical Assets -->
                <div class="flex flex-col justify-center px-4 py-3 rounded-2xl border border-[#C4CFE8] bg-gradient-card" >
                    <p class="text-xs font-medium text-[#6B2C28] mb-1">Critical</p>
                    <p class="text-2xl font-bold text-gray-800 leading-none">{{$totalCritical}}</p>
                </div>

                <!-- High Assets -->
                <div class="flex flex-col justify-center px-4 py-3 rounded-2xl border border-[#C4CFE8] bg-gradient-card" >
                    <p class="text-xs font-medium text-[#C13832] mb-1">High</p>
                    <p class="text-2xl font-bold text-gray-800 leading-none">{{$totalHigh}}</p>
                </div>

                <!-- Medium Assets -->
                <div class="flex flex-col justify-center px-4 py-3 rounded-2xl border border-[#C4CFE8] bg-gradient-card" >
                    <p class="text-xs font-medium text-[#C1603D] mb-1">Medium</p>
                    <p class="text-2xl font-bold text-gray-800 leading-none">{{$totalMedium}}</p>
                </div>

                <!-- Low Assets -->
                <div class="flex flex-col justify-center px-4 py-3 rounded-2xl border border-[#C4CFE8] bg-gradient-card" >
                    <p class="text-xs font-medium text-[#E5A550] mb-1">Low</p>
                    <p class="text-2xl font-bold text-gray-800 leading-none">{{$totalLow}}</p>
                </div>

                <!-- Minimal Assets -->
                <div class="flex flex-col justify-center px-4 py-3 rounded-2xl border border-[#C4CFE8] bg-gradient-card" >
                    <p class="text-xs font-medium text-[#E5A550] mb-1">Minimal</p>
                    <p class="text-2xl font-bold text-gray-800 leading-none">{{$totalMinimal}}</p>
                </div>
            </div>
        </div>
        {{end}}

        <!-- Possible Weaknesses -->
        {{if and .Summary.Security .Summary.Security.TopWeaknesses}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6">
            <h2 class="text-xl font-medium text-gray-700 mb-1">Possible Weaknesses</h2>
            <p class="text-xs text-gray-600 mb-3">Security weaknesses that may be applicable based on detected technologies</p>
            <div class="flex gap-2 flex-wrap items-start">
                {{range $index, $weakness := .Summary.Security.TopWeaknesses}}
                {{if lt $index 3}}
                <div class="px-3 py-1 rounded-2xl border border-[#C4CFE8] bg-gradient-card-subtle inline-block" >
                    <p class="text-xs font-medium text-gray-700">{{$weakness.Name}} <span class="text-gray-600">({{$weakness.Count}})</span></p>
                </div>
                {{end}}
                {{end}}
                {{if gt (len .Summary.Security.TopWeaknesses) 3}}
                <div class="px-3 py-1 rounded-2xl border border-[#C4CFE8] bg-gradient-card-subtle inline-block" >
                    <p class="text-xs font-medium text-gray-600">Other +{{subtract (len .Summary.Security.TopWeaknesses) 3}}</p>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}

        <!-- Qualys Threat Research Unit Insights Section -->
        {{if .TRUInsights}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 my-7 page-break-before">
            <!-- Title with TRU Logo -->
            <div class="flex items-center gap-3 mb-5">
                <img src="./assets/tru-logo.svg" alt="TRU Logo" class="h-10 w-10">
                <h2 class="text-xl font-medium text-gray-700">Top 7 Insights from <a href="#appendix-tru" class="text-gray-700 hover:text-blue-500 underline no-underline hover:underline">Qualys TRU</a> for {{if and .ReportMetadata.Industry .ReportMetadata.Industry.CompanyName}}{{.ReportMetadata.Industry.CompanyName}}{{else}}{{.ReportMetadata.TargetDomain}}{{end}}</h2>
            </div>

            <!-- Top 7 Insights -->
            <ol class="list-decimal list-outside ml-5 space-y-3 text-xs text-gray-700 leading-relaxed marker:text-blue-500 marker:font-semibold">
                {{range $insight := .TRUInsights.ThreatAssessment.TopInsights}}
                <li>{{markdownBold $insight}}</li>
                {{end}}
            </ol>

            <!-- Note about TRU -->
            <div class="mt-4 pt-3 border-t border-gray-200">
                <p class="text-xs text-gray-600 italic">
                    What is Qualys TRU? <a href="#appendix-tru" class="text-blue-500 hover:text-blue-600 no-underline hover:underline">Read appendix</a>.
                </p>
            </div>
        </div>
        {{end}}

        <!-- Marketing Section -->
        <div class="bg-[#EDF3F9] p-6 rounded-2xl my-7 flex items-center justify-between">
            <div class="flex-1">
                {{$exposedApps := add (add (add .Summary.APIServers .Summary.APISpecificationsFound) .Summary.AIAssetsFound) .Summary.WebAppsFound}}
                <h3 class="text-lg font-bold text-gray-700 mb-3 leading-tight">Attackers can see your {{$exposedApps}} applications and the technology powering them.</h3>
                <p class="text-[15px] mb-4 text-gray-600 leading-snug">Their attack plan is already in motion. Secure your APIs and Web Apps with Qualys TotalAppSec.</p>
                <a href="https://www.qualys.com/forms/totalappsec/" class="inline-block bg-blue-500 text-white px-6 py-3 rounded-full text-sm font-bold no-underline hover:bg-blue-600 transition">Try Qualys TotalAppSec</a>
            </div>
            <div class="ml-8">
                <div class="w-[170px] h-[170px] flex items-center justify-center p-2">
                    <img src="./assets/qr-code.svg" alt="QR Code" class="w-full h-full">
                </div>
            </div>
        </div>

        <!-- API Endpoints -->
        {{if .APIServers}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6 page-break-before" id="api-servers">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-medium text-gray-700">Top 5 API Servers Discovered</h2>
                <a href="#" class="text-xs text-blue-500 hover:text-blue-600 no-underline inline-flex items-center gap-1 no-print">
                    <i class="fas fa-arrow-up text-xs"></i>
                    <span>Back to Top</span>
                </a>
            </div>

            <div class="space-y-3">
                {{range $idx, $asset := .APIServers}}{{if lt $idx 5}}
                <div class="bg-gradient-card-subtle border border-[#e7eaed] rounded-2xl p-4">
                    <div class="flex items-start justify-between gap-6">
                        <!-- Status + Domain -->
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            {{if eq .Discovered "Confirmed API Endpoint"}}
                            <span class="w-2 h-2 rounded-full bg-green-500 flex-shrink-0"></span>
                            {{else}}
                            <span class="w-2 h-2 rounded-full bg-yellow-500 flex-shrink-0"></span>
                            {{end}}
                            <a href="https://{{.Domain}}" target="_blank" class="font-semibold text-sm text-gray-700 hover:text-blue-500 no-underline truncate">{{.Domain}}</a>
                        </div>

                        <!-- Metrics -->
                        <div class="flex flex-col gap-1.5 flex-shrink-0 items-end">
                            <!-- Est. TruRisk -->
                            {{if .TrueRiskRange}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none whitespace-nowrap">Est. TruRisk™</span>
                                <a href="#appendix-trurisk" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}}; border-color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}};">{{.TrueRiskRange.Min}}-{{.TrueRiskRange.Max}}</span>
                            </div>
                            {{end}}

                            <!-- ACS -->
                            {{if .Criticality}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none">ACS</span>
                                <a href="#appendix-criticality" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}}; border-color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}};">{{.Criticality.Score}}</span>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    <!-- Findings -->
                    {{if .FindingItems}}
                    <div class="mt-3 pt-2 border-t border-gray-100">
                        <div class="text-xs text-gray-600">
                            <span class="font-semibold text-gray-700">Findings:</span>
                            {{if and (eq (len .FindingItems) 1) (eq (index .FindingItems 0).DisplayName "Routing Server")}}
                            Basic web service detected
                            {{else}}
                            {{$maxDisplay := 5}}{{$total := len .FindingItems}}{{range $index, $item := .FindingItems}}{{if lt $index $maxDisplay}}{{if gt $index 0}}, {{end}}{{if and (eq $item.DisplayAs "link") $item.Values}}{{range $vindex, $val := $item.Values}}{{if gt $vindex 0}}, {{end}}<a href="{{$val}}" target="_blank" class="text-blue-500 no-underline hover:text-blue-600">{{$item.DisplayName}}</a>{{end}}{{else}}{{$item.DisplayName}}{{end}}{{end}}{{end}}{{if gt $total $maxDisplay}}<span class="text-gray-500"> +{{subtract $total $maxDisplay}} more</span>{{end}}
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
                {{end}}
        {{if gt (len $.APIServers) 5}}
        <div class="text-sm text-gray-600 mt-3 px-5 pb-3">
            <hr class="border-gray-200 mb-3">
            And {{subtract (len $.APIServers) 5}} more...
        </div>
        {{end}}
        {{end}}
            </div>
        </div>
        {{end}}

        <!-- API Specifications -->
        {{if .APISpecsFound}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6" id="api-specifications">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-medium text-gray-700">Top 5 API Specifications Discovered</h2>
                <a href="#" class="text-xs text-blue-500 hover:text-blue-600 no-underline inline-flex items-center gap-1 no-print">
                    <i class="fas fa-arrow-up text-xs"></i>
                    <span>Back to Top</span>
                </a>
            </div>

            <div class="space-y-3">
                {{range $idx, $asset := .APISpecsFound}}{{if lt $idx 5}}
                <div class="bg-gradient-card-subtle border border-[#e7eaed] rounded-2xl p-4">
                    <div class="flex items-start justify-between gap-6">
                        <!-- Domain -->
                        <div class="flex-1 min-w-0">
                            <a href="https://{{.Domain}}" target="_blank" class="font-semibold text-sm text-gray-700 hover:text-blue-500 no-underline truncate">{{.Domain}}</a>
                        </div>

                        <!-- Metrics -->
                        <div class="flex flex-col gap-1.5 flex-shrink-0 items-end">
                            <!-- Est. TruRisk -->
                            {{if .TrueRiskRange}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none whitespace-nowrap">Est. TruRisk™</span>
                                <a href="#appendix-trurisk" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}}; border-color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}};">{{.TrueRiskRange.Min}}-{{.TrueRiskRange.Max}}</span>
                            </div>
                            {{end}}

                            <!-- ACS -->
                            {{if .Criticality}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none">ACS</span>
                                <a href="#appendix-criticality" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}}; border-color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}};">{{.Criticality.Score}}</span>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    <!-- Findings -->
                    {{if .FindingItems}}
                    <div class="mt-3 pt-2 border-t border-gray-100">
                        <div class="text-xs text-gray-600">
                            <span class="font-semibold text-gray-700">Findings:</span>
                            {{$maxDisplay := 5}}{{$total := len .FindingItems}}{{range $index, $item := .FindingItems}}{{if lt $index $maxDisplay}}{{if gt $index 0}}, {{end}}{{if and (eq $item.DisplayAs "link") $item.Values}}{{range $vindex, $val := $item.Values}}{{if gt $vindex 0}}, {{end}}<a href="{{$val}}" target="_blank" class="text-blue-500 no-underline hover:text-blue-600">{{$item.DisplayName}}</a>{{end}}{{else}}{{$item.DisplayName}}{{end}}{{end}}{{end}}{{if gt $total $maxDisplay}}<span class="text-gray-500"> +{{subtract $total $maxDisplay}} more</span>{{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
                {{end}}
        {{if gt (len $.APISpecsFound) 5}}
        <div class="text-sm text-gray-600 mt-3 px-5 pb-3">
            <hr class="border-gray-200 mb-3">
            And {{subtract (len $.APISpecsFound) 5}} more...
        </div>
        {{end}}
        {{end}}
            </div>
        </div>
        {{end}}

        <!-- AI Services -->
        {{if .AIAssetsFound}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6" id="ai-services">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-medium text-gray-700">Top 5 AI Services Discovered</h2>
                <a href="#" class="text-xs text-blue-500 hover:text-blue-600 no-underline inline-flex items-center gap-1 no-print">
                    <i class="fas fa-arrow-up text-xs"></i>
                    <span>Back to Top</span>
                </a>
            </div>

            <div class="space-y-3">
                {{range $idx, $asset := .AIAssetsFound}}{{if lt $idx 5}}
                <div class="bg-gradient-card-subtle border border-[#e7eaed] rounded-2xl p-4">
                    <div class="flex items-start justify-between gap-6">
                        <!-- Domain -->
                        <div class="flex-1 min-w-0">
                            <a href="https://{{.Domain}}" target="_blank" class="font-semibold text-sm text-gray-700 hover:text-blue-500 no-underline truncate">{{.Domain}}</a>
                        </div>

                        <!-- Metrics -->
                        <div class="flex flex-col gap-1.5 flex-shrink-0 items-end">
                            <!-- Est. TruRisk -->
                            {{if .TrueRiskRange}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none whitespace-nowrap">Est. TruRisk™</span>
                                <a href="#appendix-trurisk" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}}; border-color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}};">{{.TrueRiskRange.Min}}-{{.TrueRiskRange.Max}}</span>
                            </div>
                            {{end}}

                            <!-- ACS -->
                            {{if .Criticality}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none">ACS</span>
                                <a href="#appendix-criticality" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}}; border-color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}};">{{.Criticality.Score}}</span>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    <!-- Findings -->
                    {{if .FindingItems}}
                    <div class="mt-3 pt-2 border-t border-gray-100">
                        <div class="text-xs text-gray-600">
                            <span class="font-semibold text-gray-700">Findings:</span>
                            {{$maxDisplay := 5}}{{$total := len .FindingItems}}{{range $index, $item := .FindingItems}}{{if lt $index $maxDisplay}}{{if gt $index 0}}, {{end}}{{if and (eq $item.DisplayAs "link") $item.Values}}{{range $vindex, $val := $item.Values}}{{if gt $vindex 0}}, {{end}}<a href="{{$val}}" target="_blank" class="text-blue-500 no-underline hover:text-blue-600">{{$item.DisplayName}}</a>{{end}}{{else}}{{$item.DisplayName}}{{end}}{{end}}{{end}}{{if gt $total $maxDisplay}}<span class="text-gray-500"> +{{subtract $total $maxDisplay}} more</span>{{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
                {{end}}
        {{if gt (len $.AIAssetsFound) 5}}
        <div class="text-sm text-gray-600 mt-3 px-5 pb-3">
            <hr class="border-gray-200 mb-3">
            And {{subtract (len $.AIAssetsFound) 5}} more...
        </div>
        {{end}}
        {{end}}
            </div>
        </div>
        {{end}}

        <!-- Web Applications -->
        {{if .WebAppsFound}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6 page-break-before" id="web-apps">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-medium text-gray-700">Top 5 Web Applications Discovered</h2>
                <a href="#" class="text-xs text-blue-500 hover:text-blue-600 no-underline inline-flex items-center gap-1 no-print">
                    <i class="fas fa-arrow-up text-xs"></i>
                    <span>Back to Top</span>
                </a>
            </div>

            <div class="space-y-3">
                {{range $idx, $asset := .WebAppsFound}}{{if lt $idx 5}}
                <div class="bg-gradient-card-subtle border border-[#e7eaed] rounded-2xl p-4">
                    <div class="flex items-start justify-between gap-6">
                        <!-- Domain + Details -->
                        <div class="flex-1 min-w-0">
                            <a href="https://{{.Domain}}" target="_blank" class="font-semibold text-sm text-gray-700 hover:text-blue-500 no-underline block truncate">{{.Domain}}</a>
                            {{if .Title}}
                            <div class="text-xs font-medium text-gray-600 mt-1 truncate">{{.Title}}</div>
                            {{end}}
                            {{if .Description}}
                            <div class="text-xs text-gray-500 mt-0.5 leading-snug">{{truncate .Description 180}}</div>
                            {{end}}
                        </div>

                        <!-- Metrics -->
                        <div class="flex flex-col gap-1.5 flex-shrink-0 items-end">
                            <!-- Est. TruRisk -->
                            {{if .TrueRiskRange}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none whitespace-nowrap">Est. TruRisk™</span>
                                <a href="#appendix-trurisk" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}}; border-color: {{if ge .TrueRiskRange.Min 850}}#6B2C28{{else if ge .TrueRiskRange.Min 650}}#C13832{{else if ge .TrueRiskRange.Min 400}}#C1603D{{else}}#E5A550{{end}};">{{.TrueRiskRange.Min}}-{{.TrueRiskRange.Max}}</span>
                            </div>
                            {{end}}

                            <!-- ACS -->
                            {{if .Criticality}}
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-xs text-gray-500 leading-none">ACS</span>
                                <a href="#appendix-criticality" class="text-gray-400 hover:text-gray-600 no-underline leading-none flex items-center"><i class="far fa-circle-question text-xs"></i></a>
                                <span class="font-condensed text-xs font-bold text-center leading-none bg-white rounded-full px-3 py-1 border whitespace-nowrap" style="color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}}; border-color: {{if eq .Criticality.Score 5}}#6B2C28{{else if eq .Criticality.Score 4}}#C13832{{else if eq .Criticality.Score 3}}#C1603D{{else if eq .Criticality.Score 2}}#E5A550{{else}}#E5A550{{end}};">{{.Criticality.Score}}</span>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    <!-- Findings -->
                    {{if .FindingItems}}
                    <div class="mt-3 pt-2 border-t border-gray-100">
                        <div class="text-xs text-gray-600">
                            <span class="font-semibold text-gray-700">Findings:</span>
                            {{if and (eq (len .FindingItems) 1) (eq (index .FindingItems 0).DisplayName "Web Server")}}
                            Standard web application
                            {{else}}
                            {{$maxDisplay := 5}}{{$total := len .FindingItems}}{{range $index, $item := .FindingItems}}{{if lt $index $maxDisplay}}{{if gt $index 0}}, {{end}}{{if and (eq $item.DisplayAs "link") $item.Values}}{{range $vindex, $val := $item.Values}}{{if gt $vindex 0}}, {{end}}<a href="{{$val}}" target="_blank" class="text-blue-500 no-underline hover:text-blue-600">{{$item.DisplayName}}</a>{{end}}{{else}}{{$item.DisplayName}}{{end}}{{end}}{{end}}{{if gt $total $maxDisplay}}<span class="text-gray-500"> +{{subtract $total $maxDisplay}} more</span>{{end}}
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
                {{end}}
        {{if gt (len $.WebAppsFound) 5}}
        <div class="text-sm text-gray-600 mt-3 px-5 pb-3">
            <hr class="border-gray-200 mb-3">
            And {{subtract (len $.WebAppsFound) 5}} more...
        </div>
        {{end}}
        {{end}}
            </div>
        </div>
        {{end}}

        <!-- Technologies Found -->
        {{if and .Technologies .Technologies.AllTechnologies (gt (len .Technologies.AllTechnologies) 0)}}
        <div class="bg-white border border-[#e7eaed] rounded-2xl p-5 mb-6 page-break-before" id="technologies-found">
            <div class="flex items-center justify-between mb-1">
                <h2 class="text-xl font-medium text-gray-700">Technologies Found</h2>
                <a href="#" class="text-xs text-blue-500 hover:text-blue-600 no-underline inline-flex items-center gap-1 no-print">
                    <i class="fas fa-arrow-up text-xs"></i>
                    <span>Back to Top</span>
                </a>
            </div>
            <p class="text-xs text-gray-600 mb-3">Overview of technologies and frameworks detected across your applications</p>

            <div class="grid grid-cols-3 gap-3">
                {{range .Technologies.AllTechnologies}}
                <div class="border border-[#e7eaed] rounded-2xl p-3 flex flex-col bg-gradient-card-subtle" id="tech-{{.Slug}}">
                    <!-- Tech Icon and Name -->
                    <div class="flex items-center gap-2 mb-2">
                        {{if .Icon}}
                        <div class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded">
                            <img src="./assets/{{.Icon}}" alt="{{.DisplayName}}" class="w-6 h-6 object-contain" onerror="this.style.display='none'">
                        </div>
                        {{end}}
                        <div class="flex-1 min-w-0">
                            <h3 class="text-xs font-medium text-gray-700 leading-tight truncate">{{.DisplayName}}</h3>
                            <p class="text-xs text-gray-600">{{.Count}} {{if eq .Count 1}}domain{{else}}domains{{end}}</p>
                        </div>
                    </div>

                    <!-- Security Info -->
                    {{if .Security}}
                    {{if or (and .Security.CVE (gt .Security.CVE.Stats.Critical 0)) (and .Security.Weaknesses (gt .Security.Weaknesses.Stats.Total 0))}}
                    <div class="text-xs text-gray-600 space-y-0.5">
                        {{if .Security.CVE}}
                        {{if gt .Security.CVE.Stats.Critical 0}}
                        <div><span class="font-medium text-gray-700">{{.Security.CVE.Stats.Critical}}</span> critical vulnerabilities</div>
                        {{end}}
                        {{end}}
                        {{if .Security.Weaknesses}}
                        {{if gt .Security.Weaknesses.Stats.Total 0}}
                        <div>{{.Security.Weaknesses.Stats.Total}} weaknesses linked</div>
                        {{end}}
                        {{end}}
                    </div>
                    {{end}}
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>
        {{end}}

        </div>
</body>
</html>

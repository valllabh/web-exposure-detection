id: api-host-keyword-detection
info:
  name: API Server Keyword Detection
  author: Vallabh
  severity: info
  description: Detects API servers based on hostname patterns like api., api-gateway, graphql, etc. and confirms if JSON/XML is returned.
  tags: exposure,api,detection,tech
http:
  - method: GET
    path:
      - "{{BaseURL}}"
    redirects: true
    max-redirects: 10
    matchers:
      - type: status
        status:
          - 200
          - 201
          - 204
          - 301
          - 302
          - 303
          - 307
          - 308
          - 400
          - 401
          - 403
          - 404
          - 405
          - 500
          - 502
          - 503
    extractors:
      - type: regex
        name: api_domain
        part: host
        group: 1
        internal: true
        regex:
          - '(?i)(api|apis|api-server|api-gateway|api-portal|api-docs|alpha-api|api-alpha|api-beta|api-demo|api-dev|api-fhir|api-gw|api-int|api-integration|api-preprod|api-prod|api-production|api-sandbox|api-stage|api-staging|api-stg|api-test|api-uat|api-v1|api-v2|api-v3|api1|api2|api3|apigateway|apigw|b2b-api|b2c-api|beta-api|client-api|core-api|customer-api|demo-api|dev-api|external-api|fhir|fhir-api|gateway|graph|graph-api|graphapi|graphql|gw|int-api|integration-api|internal-api|legacy-api|mapi|mobile-api|mobileapi|new-api|old-api|open-api|openapi|openbanking|partner-api|partners-api|preprod-api|private-api|prod-api|production-api|psd2|public-api|qa-api|rest-api|restapi|sandbox-api|service|services|stage-api|staging-api|stg-api|test-api|uat-api|xs2a)'
      - type: dsl
        dsl:
          - 'len(api_domain) > 0 ? to_value_group("api.domain_pattern", api_domain) : ""'
